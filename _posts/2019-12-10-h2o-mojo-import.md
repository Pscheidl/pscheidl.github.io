---
title: "H2O - Inspecting and scoring with MOJO models inside H2O"
published: true
categories:
  - H2O-3
tags:
  - H2O.ai
  - H2O-3
  - Machine learning
  - AI
---

Machine-learning models created with [H<sub>2</sub>O](https://github.com/h2oai/h2o-3) may be exported in two basic ways:

1. Binary format,
2. Model Object, Optimized (MOJO).

An H<sub>2</sub>O model can be saved in a binary format, which is tied to the very specific version of H<sub>2</sub>O it has been created with. There are multiple reasons for such a restriction. One of the important reasons is that model-building algorithms may evolve in time. The algorithm's hyperparameters, as well as the "behavior" of the algorithm itself, may change. To obtain more information about H<sub>2</sub>O models, please visit official [documentation](http://docs.h2o.ai/h2o/latest-stable/h2o-docs/save-and-load-model.html).

The second option is a MOJO. Unlike binary models, MOJOs are meant to productionize H<sub>2</sub>O models. Those are self-contained models, deployable into production environment. Typically, once a model is well-performing, a MOJO is exported and given to engineers to be deployed into production, bridging the cap between engineering and data science. In-depth description of H<sub>2</sub>O MOJOs is provided in [Productionizing H<sub>2</sub>O documentation](http://docs.h2o.ai/h2o/latest-stable/h2o-docs/productionizing.html).

Since H<sub>2</sub>O release `3.26.0.7`, it is possible to re-import MOJO models back into H<sub>2</sub>O and:

1. Inspect hyperparameters used to train the model,
1. See the scoring history,
1. **Predict**,
1. Display variable importances,
1. Use it exactly as native H<sub>2</sub>O model, except for checkpointing.

With the new MOJO import functionality, all the information about the model are available for the H<sub>2</sub>O user to inspect. Also, there is no need to use the GenModel for scoring a dataset if only the MOJO model is available - by importing it back into H<sub>2</sub>O, doing predictions with such imported model are made available. And in case the MOJO gets lost and H<sub>2</sub>O cluster has it still loaded, it can be re-exported again.

This functionality is available via all H<sub>2</sub>O intefaces: Flow, Python & R.

_Note: Besides MOJO, a similar functionality named POJO used to exist in H<sub>2</sub>O as well. POJOs are now deprecated and the functionality described in this article does not apply to POJOs._

## Flow

There are two ways to import a MOJO using Flow:

1. Use MOJO import functionality directly,
1. Pre-upload the MOJO to the H2O cluster, then use MOJO import functionality.


To access MOJO import, in the upmost menu of Flow, select the "Model" option and in the bottom part of the menu, then click on "Import MOJO Model". A dialogue appears, asking for:

1. Model ID,
1. MOJO file key,
1. Path to the MOJO.

Model ID is already pre-generated by H<sub>2</sub>O and editing it is optional. MOJO file key is an optional parameter, usable when a MOJO was pre-uploaded from H<sub>2</sub>O userÍ„'s local filesystem to the cluster and then imported. If the MOJO zip file file saved out of reach of the H<sub>2</sub>O cluster, clicking on the "Data" option in Flow's upmost menu and then using the "Upload file" dialogue to upload the MOJO first makes it possible for a MOJO to be imported.

By default, only the last input box named `path` is filled by the user. It represents path on H<sub>2</sub>O cluster's filesystem to the import MOJO zip file.

![Importing MOJO in Flow - Part 1](https://www.pavel.cool/images/mojo_import/mojo_import_1.jpg)


By clicking on the `import` button, the MOJO model is actually imported and registered inside H<sub>2</sub>O. From now on, it can be used like a normal H<sub>2</sub>O model, with a few restrictions listed above. By cliking on the `View` button, import MOJO model's details can be displayed.

![Importing MOJO in Flow - part 2](https://www.pavel.cool/images/mojo_import/mojo_import_2.jpg)

Notice the `predict` button is active - users are able to make predictions with imported MOJO models.

![Importing MOJO in Flow - part 2](https://www.pavel.cool/images/mojo_import/mojo_import_3.jpg)

## Python

As in Flow and R, there are two ways to import a MOJO using Flow:

1. Use MOJO import functionality directly,
1. Pre-upload the MOJO to the H2O cluster, then use MOJO import functionality.

The pre-upload functionality is useful when the MOJO model can not be imported directly, being out of reach of H<sub>2</sub>O cluster's filesystem, e.g. residing on user's local filesystem. Simply uploading the MOJO using `h2o.upload_file('/some/path/to/mojo.zip')` and then using the import functionality solves this problem. However, uploading the file manually and then calling the `H2OGenericEstimator`'s constructor introduces a lot of overhead. Therefore, we've introduced `h2o.upload_mojo('/path/to/some/mojo.zip')` convenience function. However, for the simplest of use cases, there is a function named `h2o.import_mojo('/some/path/to/mojo.zip')`. This function takes a path accessible by the H<sub>2</sub>O cluster, imports the MOJO and creates an `H2OGenericEstimator`. Such `H2OGenericEstimator` can hold any model, including all kinds of imported MOJO models, hence the name `Generic`.

Such a model can then be used to do predictions, just like any H<sub>2</sub>O model with `mojo_model.predict(airlines)`. In fact, all the parameters, the scoring history, it's all there ! The listing below shows a basic use-case where a GBM model is created, saved into a temporary MOJO zip file and then loaded back into H<sub>2</sub>O. Once the model is imported, making predictions with the imported MOJO model is demonstrated using `h2o.predict` function.

```python
    airlines_data = h2o.import_file("https://s3.amazonaws.com/h2o-airlines-unpacked/allyears2k.csv")
    
    ## Create a GBM model, only to later export it as a MOJO
    from h2o.estimators import H2OGradientBoostingEstimator
    original_model = H2OGradientBoostingEstimator(ntrees = 1)
    original_model.train(x = ["Origin", "Dest"], y = "IsDepDelayed", training_frame=airlines_data)

    #Save the previously created model into a temporary file
    import tempfile
    original_model_filename = tempfile.mkdtemp()
    original_model_filename = original_model.download_mojo(original_model_filename)

    # Load the model from the temporary file
    mojo_model = h2o.import_mojo(original_model_filename)
    predictions = mojo_model.predict(airlines_data)
```

As an alternative to the `h2o.import_mojo('/some/path/to/mojo.zip')` function, creating a generic model directly is possible as well with the `H2OGenericEstimator.from_file('/some/path/to/mojo.zip')` function. The result is exactly the same as with the `h2o.import_mojo` function. See the runnable example below for comparison.

```python
    airlines_data = h2o.import_file("https://s3.amazonaws.com/h2o-airlines-unpacked/allyears2k.csv")
    
    ## Create a GBM model, only to later export it as a MOJO
    from h2o.estimators import H2OGradientBoostingEstimator
    original_model = H2OGradientBoostingEstimator(ntrees = 1)
    original_model.train(x = ["Origin", "Dest"], y = "IsDepDelayed", training_frame=airlines_data)

    #Save the previously created model into a temporary file
    import tempfile
    original_model_filename = tempfile.mkdtemp()
    original_model_filename = original_model.download_mojo(original_model_filename)

    # Load the model from the temporary file using H2OGenericEstimator
    from h2o.estimators import H2OGenericEstimator
    mojo_model = H2OGenericEstimator.from_file(original_model_filename)

    predictions = mojo_model.predict(airlines_data)
```

### Upload a MOJO in Python

If the MOJO zip file is not reachable by the H<sub>2</sub>O cluster, it would need to be uploaded first with `h2o.upload_file('path/to/some/mojo.zip')` and then, the key to the uploaded file would be required to be supplied to the `H2OGenericEstimator`'s constructor. However, for uploading a MOJO not reachable directly by the H<sub>2</sub>O cluster, there is a convenience function `h2o.upload_mojo('/path/to/some/mojo.zip')`. Internally, the MOJO zip file is uploaded into H<sub>2</sub>O and represented as a `Frame` of bytes. Afterwards, the key of such byte Frame is supplied to the `H2OGenericEstimator`, creating a Generic model by using the provided frame, instead of trying to import a file from cluster's filesystem.

A fully reproducible example is to be found in the following example.

```python
    airlines_data = h2o.import_file("https://s3.amazonaws.com/h2o-airlines-unpacked/allyears2k.csv")
    
    ## Create a GBM model, only to later export it as a MOJO
    from h2o.estimators import H2OGradientBoostingEstimator
    original_model = H2OGradientBoostingEstimator(ntrees = 1)
    original_model.train(x = ["Origin", "Dest"], y = "IsDepDelayed", training_frame=airlines_data)

    #Save the previously created model into a temporary file
    import tempfile
    original_model_filename = tempfile.mkdtemp()
    original_model_filename = original_model.download_mojo(original_model_filename)
    
    # Upload a MOJO model and create a Generic model out of it
    mojo_model = h2o.upload_mojo(original_model_filename)

    predictions = mojo_model.predict(airlines_data)
```



## R

As in Flow and Python, there are two ways to import a MOJO using Flow:

1. Use MOJO import functionality directly,
1. Pre-upload the MOJO to the H2O cluster, then use MOJO import functionality.

The pre-upload functionality is useful when the MOJO model can not be imported directly, being out of reach of H<sub>2</sub>O cluster's filesystem, e.g. residing on user's local filesystem. Simply uploading the MOJO using `h2o.upload_file('/some/path/to/mojo.zip')` and then using the `h2o.generic(model_key = 'some_model_key')` functionality solves this problem, but is a lot of work to do. Therefore, there is a convenience function named `h2o.upload_mojo('/path/to/some/mojo.zip)`, which does everything in a single call. MOJO upload in R has its dedicated section below, named _"Upload a MOJO in R"_. However, for the simplest of use cases, there is a function named `h2o.import_mojo('/some/path/to/mojo.zip')`. This function takes a path accessible by the H<sub>2</sub>O cluster, imports the MOJO and creates an `H2OGenericEstimator`. Such `H2OGenericEstimator` can hold any model, including all kinds of imported MOJO models, hence the name `Generic`.

Such a model can then be used to do predictions, just like any H<sub>2</sub>O model with `mojo_model.predict(airlines)`. In fact, all the parameters, the scoring history, it's all there ! The listing below shows a basic use-case where a GBM model is created, saved into a temporary MOJO zip file and then loaded back into H<sub>2</sub>O. Once the model is imported, making predictions with the imported MOJO model is demonstrated using `h2o.predict` function.

```R
airlines_data <- h2o.importFile("https://s3.amazonaws.com/h2o-airlines-unpacked/allyears2k.csv")

## Create a GBM model, only to later export it as a MOJO
original_model <- h2o.gbm(x = c("Origin", "Dest"), y = "IsDepDelayed", training_frame=airlines_data, ntrees = 1)

#Save the previously created model into a temporary file
original_mojo_path <- h2o.download_mojo(model = original_model, path = tempdir())
original_mojo_path <- paste0(tempdir(),"/",original_mojo_path)

# Load the model from the temporary file
mojo_model <- h2o.import_mojo(original_mojo_path)
predictions  <- h2o.predict(mojo_model, airlines_data)
```

As an alternative to the `h2o.import_mojo('/some/path/to/mojo.zip')` function, creating a generic model is also possible by calling `h2o.genericModel('/some/path/to/mojo.zip')` function. The result is exactly the same as with the `h2o.import_mojo` function. See the runnable example below for comparison.

```R
airlines_data <- h2o.importFile("https://s3.amazonaws.com/h2o-airlines-unpacked/allyears2k.csv")

## Create a GBM model, only to later export it as a MOJO
original_model <- h2o.gbm(x = c("Origin", "Dest"), y = "IsDepDelayed", training_frame=airlines_data, ntrees = 1)

#Save the previously created model into a temporary file
original_mojo_path <- h2o.download_mojo(model = original_model, path = tempdir())
original_mojo_path <- paste0(tempdir(),"/",original_mojo_path)

# Load the model from the temporary file
mojo_model <- h2o.genericModel(original_mojo_path)
predictions  <- h2o.predict(mojo_model, airlines_data)
```

### Upload a MOJO in R

If the MOJO zip file is not reachable by the H<sub>2</sub>O cluster, it would need to be uploaded first with `h2o.upload_file('path/to/some/mojo.zip')` and then, the key to the uploaded file would be required to be supplied to the `h2o.generic` function. However, for uploading a MOJO not reachable directly by the H<sub>2</sub>O cluster, there is a convenience function `h2o.upload_mojo('/path/to/some/mojo.zip')`. Internally, the MOJO zip file is uploaded into H<sub>2</sub>O and represented as a `Frame` of bytes. Afterwards, the key of such byte Frame is supplied to the `h2o.generic(model_key = 'some_h2o_key')`, creating a Generic model by using the provided frame, instead of trying to import a file from cluster's filesystem.

A fully reproducible example is to be found in the following example.

```R
airlines_data <- h2o.importFile("https://s3.amazonaws.com/h2o-airlines-unpacked/allyears2k.csv")

## Create a GBM model, only to later export it as a MOJO
original_model <- h2o.gbm(x = c("Origin", "Dest"), y = "IsDepDelayed", training_frame=airlines_data, ntrees = 1)

#Save the previously created model into a temporary file
original_mojo_path <- h2o.download_mojo(model = original_model, path = tempdir())
original_mojo_path <- paste0(tempdir(),"/",original_mojo_path)

# Load the model from the temporary file
mojo_model <- h2o.upload_mojo(original_mojo_path)
predictions  <- h2o.predict(mojo_model, airlines_data)
```